1) Убрать варнинги
2) map и sprintf при отрисовке таблиц рулят неимоверно. grep - при фильтрации.
   Все или почти все циклы for внутри paint можно эффективно и красиво заменить на map
   внутри какой-нибудь функции. В идеале одна строка в таблице должна отрисовываться одним printf
   или sprintf. Также подумай вот о чем. Меняется ли у тебя разделитель между строками?
   И можешь ли ты представить себе таблицу, как ее строки, соединенные разделителем?
   Если да, то ты избавишься от условия $row ne $result->[$#$result]
